<html>
<head>
  <title>FOAF Vocabulary Specification</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <link href="http://xmlns.com/xmlns-style.css" rel="stylesheet"  type="text/css" />
  <link href="http://smiy.sourceforge.net/css/style.css" rel="stylesheet"  type="text/css" />
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://www.kanzaki.com/parts/turtle.js"></script>

<script>
// need this function
if (typeof String.prototype.startsWith != 'function') {
  String.prototype.startsWith = function (str){
    return this.slice(0, str.length) == str;
  };
}

function MustacheRDF(rdf, ns) {
  this.rdf = rdf;
  this.ns = ns;

  this.reg = /{{(.*?)}}/g; // this is for curly brackets

  this.init();
}
MustacheRDF.prototype.init = function() {
  var that = this;

  // replace all instance of curly
  var replaced = $('body').html().replace(this.reg, function() {
    var triple = arguments[1]; 

    var obj = that.findPattern(triple);
    
    return obj;
  });

  $('body').html(replaced);
}

MustacheRDF.prototype.expandTriple = function(triple) {
  // break it into triples, they're separated by space
  var tripleArr = triple.split(' ');

  // for each triple, see if it starts with a namespace in this.ns
  for(var i in tripleArr) {

    for(var n in this.ns) {
      if(tripleArr[i].startsWith(n)) {
        tripleArr[i] = tripleArr[i].replace(n, this.ns[n], 'g'); 
        break;
      }
    }
  }
  return tripleArr;
}
MustacheRDF.prototype.findTriple = function(triple) {

  var arg = ['subject', 'predicate', 'object'];

  // supporting only 1 arg for now
  for(var x in triple) {
    if(triple[x].startsWith('?')) {
      arg = arg[x];
      break;
    }
  }

  for(var i in this.rdf) {
    var subject = this.rdf[i].subject;
    var predicate = this.rdf[i].predicate;
    var object = this.rdf[i].object;

    if(
      (triple[0].startsWith('?') || triple[0] == subject)
      &&
      (triple[1].startsWith('?') || triple[1] == predicate)
      &&
      (triple[2].startsWith('?') || triple[2] == object)
    ){
      // matched
      return this.rdf[i][arg];

    }

  }

}

MustacheRDF.prototype.findPattern = function(triple) {
  var tripleArr = this.expandTriple(triple);

  var obj = this.findTriple(tripleArr);
  return obj;
}


$(function(){
  
  var url = 'https://api.github.com/repos/bioversity/cco/contents/cco.ttl?callback=?';

  $.getJSON(url, function(data) {
    // atob() breaks with newlines, so remove them
    var ttl = atob(data.data.content.replace(/\s/g, ''));

    var turtle = new ParseTurtle();

    // do parsing and get namespaces
    var rdf = turtle.parse(ttl);
    var ns = turtle.ns;

    // now, with these two piece of info.
    // use jquery to find {{..}} elements
    // and modify them directly
    new MustacheRDF(rdf, ns);

  })  
});

</script>

</head>

<body>
  <h1>{{cco: dc:title ?o}} {{cco: dc:hasVersion ?o}}<br /></h1>

  <h2>Namespace Document 9 August 2010 - <em>Marco Polo Edition</em></h2>

  <dl>
    <dt>This version:</dt>
    <dd><a href="http://xmlns.com/foaf/spec/20100809.html">http://xmlns.com/foaf/spec/20100809.html</a> (<a href="20100809.rdf">rdf</a>, <a href="http://wiki.foaf-project.org/w/FoafSpec20100809">wiki</a>)</dd>

    <dt>Latest version:</dt>
    <dd><a href="http://xmlns.com/foaf/spec/">http://xmlns.com/foaf/spec/</a> (<a href="index.rdf">rdf</a>, <a href="http://wiki.foaf-project.org/w/">wiki</a>)</dd>

    <dt>Previous version:</dt>
    <dd><a href="http://xmlns.com/foaf/spec/20100101.html">http://xmlns.com/foaf/spec/20100101.html</a> (<a  href="20100101.rdf">rdf</a>, <a href="http://wiki.foaf-project.org/w/FoafSpec20100101.html">wiki</a>)</dd>
    <dt>Authors:</dt>
    <dd><a href="mailto:danbri@danbri.org">Dan Brickley</a>,
    <a href="mailto:libby@nicecupoftea.org">Libby Miller</a></dd>

    <dt>Contributors:</dt>

    <dd>Members of the FOAF mailing list (<a href=
    "http://lists.foaf-project.org/">foaf-dev@lists.foaf-project.org</a>)
    and the wider <a href="http://www.w3.org/2001/sw/interest/">RDF
    and Semantic Web developer community</a>. See <a href=
    "#sec-ack">acknowledgements</a>.</dd>
  </dl>

  <p class="copyright">Copyright &#169; 2000-2010 Dan Brickley and Libby Miller</p>
  <div about=""  resource="http://www.w3.org/TR/rdfa-syntax"  rel="dct:conformsTo" />
  <p about=""><a href="http://validator.w3.org/check?uri=referer"><img style="border: 0; float: right; padding: 5px;" 
        src="http://www.w3.org/Icons/valid-xhtml-rdfa-blue"   alt="Valid XHTML + RDFa"  /></a>

  <!-- Creative Commons License -->
   <a href="http://creativecommons.org/licenses/by/1.0/"></a> This work is licensed under a <a  rel="license" href= 
  "http://creativecommons.org/licenses/by/1.0/">Creative Commons Attribution License</a>. This copyright applies to the <em>FOAF Vocabulary Specification</em> and accompanying documentation in RDF. Regarding underlying technology, FOAF uses W3C's <a href="http://www.w3.org/RDF/">RDF</a> technology, an open Web standard that can be freely used by anyone.</p>
  
  <hr />

</body>
</html>

